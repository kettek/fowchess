behavior Board(width, height)
  init
    add .Board
    make <table.board/> called table
    repeat height times
      make <tr/> called row
      repeat width times
        make <td/> called cell
        set cell's @script to 'install Cell'
        set cell's @x to row's children's length
        set cell's @y to table's children's length

        -- TEMP
        if table's children's length is 3 and row's children's length is 3
          make <div.Piece.Queen.black/> called piece
          set piece's @draggable to true
          set piece's @script to 'install Piece'
          put piece at the end of cell
        end

        put cell at the end of row
      end
      put row at the end of table
    end
    put table into me
  end
end

behavior Piece
end

behavior Cell
  on dragstart(clientX, clientY)
    set piece to the first <div.Piece/> in me
    if piece then
      set event.dataTransfer.effectAllowed to 'move'
      call event.dataTransfer.setDragImage(me, 0, 0)
      call event.dataTransfer.setData('from', my @x + 'x' + my @y)
      -- TODO: We could target all <td/>s, then check if each would be a valid location, and if so, set '.valid', otherwise '.invalid'. These would then be cleared on dragend.
    end
  end
  on dragenter
    halt the event
  end
  on dragover
    halt the event
    -- TODO: Check if the move would be valid?
    set event.dataTransfer.dropEffect to 'move'
    add .targetTile
  end
  on dragleave or drop
    remove .targetTile
  end
  on drop
    log `move from ${event.dataTransfer.getData('from')} to ${my @x} x ${my @y}`
    -- TODO: Send move request.
  end
end