eventsource GameUpdates
  on message as json
    log it
  end

  on open
    log "opened stream"
  end

  on exit
    log "got exit"
    GameUpdates.close()
  end
end

behavior Game()
  on mutation of @game_id
    GameUpdates.open('http://localhost:4000/stream')
    -- TODO: Issue fetch for game?
    log "TODO: Some sort of game API fetch"
  end
end

def game.create()
  fetch /game/create as json with headers: {'Content-Type': 'application/json'}, method:"POST", body: JSON.stringify({name: "big john"})
  log it
  set #game's @game_id to "some game"
end

def game.join(id)
  -- TODO
  log "join " + id
end

def game.leave()
  -- TODO
  log "leave"
end